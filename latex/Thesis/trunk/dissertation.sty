% ******************************************************************************
% dissertation.sty
%
% Copyright (C) 2009 Zvonko Kosic-Krnjajic
% ******************************************************************************
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{dissertation}%
	[2009/08/31 v0.1 Typographic Style for a classic looking dissertation]
\RequirePackage{ifthen}
\newboolean{@tocaligned} % the left column of the toc will be aligned (no indention)
\newboolean{@dottedtoc} % page numbers in ToC flushed right
\newboolean{@listsseparated} % toggles the vertical space between lof/lot entries of different chapters
% ******************************************************************************
% Options
% ******************************************************************************
\DeclareOption{tocaligned}{\setboolean{@tocaligned}{false}}
\DeclareOption{dottedtoc}{\setboolean{@dottedtoc}{false}} 
\DeclareOption{listsseparated}{\setboolean{@listsseparated}{false}}
\ProcessOptions\relax


% ******************************************************************************
% Colors (cmyk color space) (need to load it first, other package may load it..)
% ******************************************************************************
\RequirePackage[cmyk, xetex, dvipsnames, x11names, table, hyperref]{xcolor} 

\definecolor{textcolor}{cmyk}{0.61, 0.56, 0.47, 0.06}
\definecolor{seccolor}{cmyk}{0.57, 0.41, 0.82, 0.29}

\definecolor{Brown0}{cmyk}{0.33, 0.31, 0.32, 0.01}

\definecolor{plotcolor0}{HTML}{CEAD7E}

\definecolor{listingbgcolor}{cmyk}{0.04, 0.02, 0.03, 0.0}

\colorlet{listingbgcolor}{listingbgcolor!90!white}
\colorlet{listingfgcolor}{listingbgcolor!95!black}

\colorlet{lcolor}{seccolor}
\colorlet{ccolor}{seccolor}
\colorlet{ucolor}{seccolor}
\colorlet{lstbgcolor}{listingbgcolor}
\colorlet{lstrlcolor}{listingfgcolor}



% ******************************************************************************
% Load needed Packages
% ******************************************************************************
\RequirePackage{subfig}  
\newcommand{\subfigureautorefname}{\figureautorefname}

\RequirePackage{fltpoint}
\RequirePackage{listings}  
\RequirePackage{textcomp}
\RequirePackage{pdfpages} % to include pdf pages (FrontCover..)
\RequirePackage{xspace} % to get the spacing after macros right
\RequirePackage{tabularx} % better tables
\RequirePackage{mparhack} % get marginpar right
\RequirePackage{fixltx2e} % fixes some LaTeX stuff
\RequirePackage{relsize} % scale font up or down
\RequirePackage[ngerman,american]{babel}           
\RequirePackage[square,numbers]{natbib} 
\RequirePackage[fleqn]{amsmath} % math environments and more by the AMS 
\RequirePackage{amssymb}
\RequirePackage{amsfonts}

% ******************************************************************************
% leading ...
% ******************************************************************************
\RequirePackage{leading}
% increase leading a bit for better readability.. default font size * 120%
\leading{15pt}

% ******************************************************************************
% pgfplots (very nice graph plots)
% ******************************************************************************
\RequirePackage{pgfplots}
\pgfplotsset{
	every tick label/.append style={font=\plotfont\scriptsize},
	every axis/.append style={font=\footnotesize\plotfont},
	every axis x label/.style={at={(0.5,0)}, below, yshift=-20pt}
}

% ******************************************************************************
% pgfplotstable (very nice tables)
% ******************************************************************************
\RequirePackage{pgfplotstable}
\pgfplotstableset{
	every head row/.style={before row={\toprule},after row=\midrule},
	every last row/.style={after row=\bottomrule},
	font=\color{textcolor}%\scshape
}
% recommendations...
\RequirePackage{booktabs}
\RequirePackage{array} 
\RequirePackage{colortbl}


% ******************************************************************************
% Math Package
% ******************************************************************************
%\RequirePackage[retainmissing,abx]{MnSymbol}
%\RequirePackage[fraktur,mdugm]{mathdesign}
\RequirePackage[bitstream-charter]{mathdesign}
%\RequirePackage[euler-digits]{eulervm} % Euler math fonts
%\RequirePackage[minionint, openg, mathosf, onlymath]{MinionPro}% 
%\RequirePackage[osf,sc]{mathpazo} % Palatino with smallcaps and osf


% ******************************************************************************
% Commands
% ******************************************************************************
\newcounter{dummy} % necessary for correct hyperlinks (to index, bib, etc.)
%\numberwithin{lstlisting}{section} % Make sure listings are numbered by section
%\numberwithin{equation}{section} % Make sure equations are numbered by section
%\numberwithin{figure}{section} % Make sure equations are numbered by section
%\numberwithin{table}{section} % Make sure equations are numbered by section


% ******************************************************************************
% Penalties
% ******************************************************************************
% Disable single lines at the start of a paragraph (Schusterjungen)
\clubpenalty = 1000
% Disable single lines at the end of a paragraph (Hurenkinder)
\widowpenalty = 1000 
\displaywidowpenalty = 1000 % formulas
% single space betweeen sentences
\frenchspacing
% prevents LaTeX from adding vertical white space in strange places on pages
% that it cannot fill properly. 
\raggedbottom


% ******************************************************************************
% XeTeX
% ******************************************************************************
\RequirePackage[toc,eqno,enum,bib,lineno]{tabfigures}
\RequirePackage[cm-default, no-math]{fontspec}
\RequirePackage{xunicode}
\RequirePackage{xltxtra}
%\RequirePackage{polyglossia}

\defaultfontfeatures{Mapping=tex-text, Numbers=OldStyle, Ligatures=NoCommon}
\newcommand{\mainfont}{Charter OS ITC TT}
\newcommand{\scfont}{Charter SC ITC TT}
%\newcommand{\mainfont}{LeMonde Livre OsF}
%\newcommand{\scfont}{LeMonde Livre SC}
%\newcommand{\mainfont}{Minion Pro}
%\newcommand{\scfont}{Minion Pro}

%\setdefaultlanguage{UKenglish} % polyglossia

%5–10% of the size of the type.

\setmainfont{\mainfont}
%\setsansfont{Verdana}
%\setmonofont{Pragmata}
\newfontfamily\plotfont[Numbers=OldStyle]{\mainfont}
\newfontfamily\lstfont[Scale=0.8]{Luxi Mono}
\newfontfamily\scshape[LetterSpace=8.0, Letters=SmallCaps]{\scfont} % sc 5 - 10 %
\renewcommand{\textsc}[1]{\scshape{#1}}

\newfontfamily\spaceduppercase[LetterSpace=20.0]{Charter ITC TT} % uc 20 - 25 %
\newfontfamily\chnumfont[Scale=6, Numbers=Lining]{Charter ITC TT}

% ******************************************************************************
% Spacing & SmallCaps stuff
% ******************************************************************************
\RequirePackage[overload]{textcase} % for \MakeTextUppercase
\DeclareRobustCommand{\sucsmallcaps}[1]{\textsc{\MakeTextUppercase{#1}}}%   
\DeclareRobustCommand{\slcsmallcaps}[1]{\textsc{\MakeTextLowercase{#1}}}%
\DeclareRobustCommand{\ssmallcaps}[1]{\textsc{#1}}%

\DeclareRobustCommand{\suppercase}[1]{\spaceduppercase{\MakeTextUppercase{#1}}}%   


% ******************************************************************************
% Typesetting... typeares
% ******************************************************************************

%\areaset[0mm]{360pt}{576pt} % 686 (factor 2.2) + 33 head + 42 head \the\footskip
\RequirePackage[colorgrid, draft]{showframe}

\RequirePackage[twoside,includeheadfoot]{geometry}
\geometry{textwidth=360pt}
\geometry{textheight=583.2pt} % 384 * 1.62
% golden section .. 
\geometry{hmarginratio=100:162}
\geometry{vmarginratio=100:162}
% KOMA - default 1.25\baselineskip
\geometry{headheight=12pt}


% left = (one inch) 72 + (oddsidemargin) 18 = 90pt
% 90 + 360 = 450 ; 597 - 450 = 147  ... 
% \marginparwidth 84pt 

% ******************************************************************************
% Randnotiz stuff ...
% ******************************************************************************
\setlength{\marginparwidth}{7em}% == 12*7 = 84pt
\setlength{\marginparsep}{2em}% 24:40 .. 1:1.62

% ******************************************************************************
% Hyperreferences
% ******************************************************************************
\RequirePackage[xetex, pdfpagelabels, pagebackref]{hyperref}
\hypersetup{%
	colorlinks=true, linktocpage=true, pdfstartpage=3, pdfstartview=FitV,%
	breaklinks=true, pdfpagemode=UseNone, pageanchor=true, pdfpagemode=UseOutlines,%
	plainpages=false, bookmarksnumbered, bookmarksopen=true, bookmarksopenlevel=1,%
	hypertexnames=true, pdfhighlight=/O, hyperfootnotes=false, frenchlinks,%nesting=true, %
	urlcolor=lcolor, linkcolor=lcolor, citecolor=ccolor, %pagecolor=RoyalBlue,%
	% uncomment the following line if you want to have black links (e.g., for printing)
	%urlcolor=Black, linkcolor=Black, citecolor=Black, %pagecolor=Black,%
	pdftitle={\myTitle},%
	pdfauthor={\textcopyright\ \myName, \myUni, \myFaculty},%
	pdfsubject={},%
	pdfkeywords={},%
	pdfcreator={XeLaTeX},%
	pdfproducer={XeLateX ... }%
}
\renewcommand{\figureautorefname}{Figure}
\renewcommand{\tableautorefname}{Table}
\renewcommand{\partautorefname}{Part}
\renewcommand{\chapterautorefname}{Chapter}
\renewcommand{\sectionautorefname}{Section}
\renewcommand{\subsectionautorefname}{Section}
\renewcommand{\subsubsectionautorefname}{Section}

% ******************************************************************************
% Captions look and feel
% ******************************************************************************
\RequirePackage{caption}[2008/04/01]
%\RequirePackage{subcaption}
\DeclareCaptionFont{seccolor}{\color{seccolor}}
\DeclareCaptionFont{textcolor}{\color{textcolor}}
\DeclareCaptionLabelSeparator{zspace}{ }

\captionsetup{skip=\baselineskip, font=small, format=hang,%
 			  labelfont={sc, seccolor}, textfont=textcolor}
\captionsetup[subtable]{labelsep=quad}
\captionsetup[subfigureautorefname]{labelsep=quad}

%\renewcommand{\captionfont}{\small\color{textcolor}}
%\renewcommand{\captionlabelfont}{\scshape\color{seccolor}}
%\setlength{\intextsep}{14.5pt}
%\setlength{\intextsep}{10pt plus 4pt minus 4pt}


% ******************************************************************************
% algorithm2e
% ******************************************************************************
\RequirePackage[algochapter, algo2e, boxed]{algorithm2e}
\SetAlgorithmName{Algorithm}{Algorithm}

% In Fact caption is printed as follow :
% \AlCapSty{\AlCapFnt Algorithm 1:} \AlCapNameSty{\AlCapNameFnt my algorithm}
\renewcommand{\AlCapSty}{\captionfont}%
\renewcommand{\AlCapFnt}{\captionlabelfont}%
\renewcommand{\AlCapNameSty}{\captionfont}% 

\SetAlCapSkip{\baselineskip}%
%\SetAlgoSkip{medskip}
% space before box & after box
\renewcommand{\@algoskip}{\vspace{\baselineskip}}%\SetAlgoSkip{bigskip}%
%\setlength{\algomargin}{2em}% margin in the box

% ******************************************************************************
% paralist  (Allow for smarter labeling of enumerations)
% ******************************************************************************
% and itemizations (consider using enumitem instead)
\RequirePackage[newitem, newenum]{paralist}


% ******************************************************************************
% PDFpages
% ******************************************************************************
\RequirePackage{pdfpages} % for including a frontcover 

% ******************************************************************************
% glossaries
% ******************************************************************************
\RequirePackage[section=chapter,toc,acronym=true]{glossaries}
\RequirePackage{glossary-longragged}
\makeglossary

% glossaries newstyle longraggedleft
\renewcommand{\glossaryname}{\slcsmallcaps}
\newglossarystyle{longraggedleft}{%
  \renewenvironment{theglossary}%
     {\setlength\LTpost{0pt}%
		\setlength\LTpre{0pt}%
		\setlength\LTleft{0pt}%
	  	\setlength\LTright{0pt}% 
	  	\begin{longtable}{@{}l@{}p{\glsdescwidth}}}%
     {\end{longtable}}%
  \renewcommand*{\glossaryheader}{}%
  \renewcommand*{\glsgroupheading}[1]{}%

  \renewcommand*{\glossaryentryfield}[5]{%
    \ssmallcaps{ \glstarget{##1}{##2}} \hspace{2.5em} 
    & ##3 \glspostdescription\space \hspace{1.0em} ##5 \tabularnewline}%

  \renewcommand*{\glossarysubentryfield}[6]{%
     & \glstarget{##2}{\strut}##4 \glspostdescription\space ##6%
    \tabularnewline}%
  \renewcommand*{\glsgroupskip}{ & \tabularnewline}%
}
% ******************************************************************************                
% headlines
% ******************************************************************************  
\RequirePackage[automark]{scrpage2} % provides headers and footers (KOMA Script)

% Reset all headerstuff
\clearscrheadings
\clearscrheadfoot
\setheadsepline{0pt}
\setfootsepline{0pt}

% Remove the numbers from chapter and section mark
\renewcommand{\chaptermark}[1]{\markboth{\slcsmallcaps{#1}}{\slcsmallcaps{#1}}}
\renewcommand{\sectionmark}[1]{\markright{\slcsmallcaps{#1}}} 

\lehead{\slcsmallcaps{\color{seccolor}\small\headmark}} 	
\rehead{\slcsmallcaps{\color{seccolor}\small\thepage}}
\lohead{\slcsmallcaps{\color{seccolor}\small\thepage}} 	
\rohead{\slcsmallcaps{\color{seccolor}\small\headmark}}

% ******************************************************************************                
% Tables
% ******************************************************************************  
%\newcommand{\tableheadline}[1]{\multicolumn{1}{c}{\slcsmallcaps{#1}}}


% ******************************************************************************
% Layout of the chapter-, section-, subsection-, subsubsection-,
% paragraph and description-headings
% ******************************************************************************             
\RequirePackage{titlesec}
% \titleformat{⟨command⟩}[⟨shape⟩] {⟨format⟩}
% {⟨label⟩}{⟨sep⟩}
% {⟨before⟩}[⟨after⟩]

%\titleformat{⟨command⟩}[⟨shape⟩]
% {⟨format⟩}{⟨label⟩}
% {⟨sep⟩}{⟨before⟩}[⟨after⟩]

% parts
\titleformat{\part}[display]{\normalfont\centering\large}%
{\thispagestyle{empty}\partname~\MakeTextUppercase{\thepart}}{1em}%
{\color{seccolor}\spacedallcaps}%
% chapters

\titleformat{\chapter}[display]{\vspace*{-1\baselineskip}}
{\marginpar{\vspace*{\baselineskip}\color{textcolor!30!white}\chnumfont\thechapter}}{0pt}% "Chapter" name.. label 
{\raggedright\suppercase}[\vspace*{\baselineskip}\titlerule] % titlebody

%\raggedright <- linksbündig

% sections
\titleformat{\section}{\color{seccolor}}
{\slcsmallcaps{\thesection}}{1em}%
{\ssmallcaps}%
% subsections
\titleformat{\subsection}{\color{seccolor}}%
{\slcsmallcaps{\thesubsection}}{1em}%
{\normalsize\itshape}
% subsubsections
\titleformat{\subsubsection}{\color{seccolor}}%
{\slcsmallcaps{\thesubsubsection}}{1em}%
{\normalsize\itshape}        
% paragraphs
\titleformat{\paragraph}[runin]{\color{seccolor}\normalfont\normalsize}%
{\theparagraph}{0pt}%
{\slcsmallcaps}    
% descriptionlabels
\renewcommand{\descriptionlabel}[1]{\hspace*{\labelsep}\slcsmallcaps{#1}}%   

% spacing
% \titlespacing*{⟨command⟩}{⟨left⟩}{⟨beforesep⟩}{⟨aftersep⟩}[⟨right⟩]
\titlespacing*{\chapter}{0pt}{0pt}{1.25\baselineskip}
\titlespacing*{\section}{0pt}{\baselineskip}{\baselineskip} 
\titlespacing*{\subsection}{0pt}{\baselineskip}{\baselineskip}
\titlespacing*{\paragraph}{0pt}{\baselineskip}{\baselineskip}

% ********************************************************************                
% layout of the TOC, LOF and LOT (LOL-workaround see next section)
% ********************************************************************
\RequirePackage[subfigure,titles]{tocloft}
% avoid page numbers being right-aligned in fixed-size box              
\newlength{\newnumberwidth}
\settowidth{\newnumberwidth}{99} % yields overfull hbox warnings for pages > 99
\cftsetpnumwidth{\newnumberwidth}
% have the bib neatly positioned after the rest
\newlength{\beforebibskip}  
\setlength{\beforebibskip}{0em}

% pagenumbers right after the titles
% parts
\renewcommand{\thepart}{\roman{part}}%
\renewcommand{\cftpartpresnum}{\slcsmallcaps}% 
%\renewcommand{\cftpartaftersnum}{\cftchapaftersnum}%
%\renewcommand{\cftpartaftersnumb}{\quad}%
%\setlength{\cftpartnumwidth}{\cftpartnumwidth}
\renewcommand{\cftpartfont}{\color{seccolor}\normalfont}%
\renewcommand{\cftpartpagefont}{\normalfont}%
\ifthenelse{\boolean{@dottedtoc}}{\relax}%
{%
	\renewcommand{\cftpartleader}{\hspace{1.5em}}% 
	\renewcommand{\cftpartafterpnum}{\cftparfillskip}%
}%        
\setlength{\cftbeforepartskip}{1em}%
\setlength{\cftbeforechapskip}{.1em}%
\setlength{\beforebibskip}{\cftbeforepartskip}%

% chapters
\renewcommand{\cftchappresnum}{\slcsmallcaps}%
\renewcommand{\cftchapfont}{\color{seccolor}\ssmallcaps}%
\renewcommand{\cftchappagefont}{\ssmallcaps}%
\ifthenelse{\boolean{@dottedtoc}}{\relax}%
{%
	\renewcommand{\cftchapleader}{\hspace{1.5em}}% 
	\renewcommand{\cftchapafterpnum}{\cftparfillskip}% 
}
%\setlength{\cftbeforechapskip}{.1em}%           

% sections
\renewcommand{\cftsecpresnum}{\slcsmallcaps}%
\renewcommand{\cftsecfont}{\normalfont}%
\renewcommand{\cftsecpagefont}{\normalfont}%
\ifthenelse{\boolean{@dottedtoc}}{\relax}%
{%        
	\renewcommand{\cftsecleader}{\hspace{1.5em}}% 
	\renewcommand{\cftsecafterpnum}{\cftparfillskip}%
}
\ifthenelse{\boolean{@tocaligned}}{\renewcommand{\cftsecindent}{0em}}{\relax}

% subsections
\renewcommand{\cftsubsecpresnum}{\slcsmallcaps}%
\renewcommand{\cftsubsecfont}{\normalfont}%
\ifthenelse{\boolean{@dottedtoc}}{\relax}%
{%      
	\renewcommand{\cftsubsecleader}{\hspace{1.5em}}% 
	\renewcommand{\cftsubsecafterpnum}{\cftparfillskip}%   
}
\ifthenelse{\boolean{@tocaligned}}{\renewcommand{\cftsubsecindent}{0em}}{\relax}

% subsubsections
\renewcommand{\cftsubsubsecpresnum}{\slcsmallcaps}%
\renewcommand{\cftsubsubsecfont}{\normalfont}%
\ifthenelse{\boolean{@dottedtoc}}{\relax}%
{%      
	\renewcommand{\cftsubsubsecleader}{\hspace{1.5em}}% 
	\renewcommand{\cftsubsubsecafterpnum}{\cftparfillskip}%   
}             
\ifthenelse{\boolean{@tocaligned}}{\renewcommand{\cftsubsubsecindent}{0em}}{\relax}

% figures     
\renewcommand{\cftfigpresnum}{\slcsmallcaps}% 
\renewcommand{\cftfigfont}{\normalfont}%                 
\ifthenelse{\boolean{@dottedtoc}}{\relax}%
{%
	\renewcommand{\cftfigleader}{\hspace{1.5em}}% 
	\renewcommand{\cftfigafterpnum}{\cftparfillskip}%
}
\renewcommand{\cftfigpresnum}{\ssmallcaps\figurename~}%Fig.~}
\newlength{\figurelabelwidth}
\settowidth{\figurelabelwidth}{\cftfigpresnum~99}
\addtolength{\figurelabelwidth}{2.5em}
\cftsetindents{figure}{0em}{\figurelabelwidth}

% tables
\renewcommand{\cfttabpresnum}{\slcsmallcaps}%
\renewcommand{\cfttabfont}{\normalfont}%
\ifthenelse{\boolean{@dottedtoc}}{\relax}%
{%
	\renewcommand{\cfttableader}{\hspace{1.5em}}% 
	\renewcommand{\cfttabafterpnum}{\cftparfillskip}%   
} 
\renewcommand{\cfttabpresnum}{\ssmallcaps\tablename~}%Tab.~}
\newlength{\tablelabelwidth}
\settowidth{\tablelabelwidth}{\cfttabpresnum~99}
\addtolength{\tablelabelwidth}{2.5em}
\cftsetindents{table}{0em}{\tablelabelwidth}
\cftsetindents{table}{0em}{\figurelabelwidth}

% listings
\renewcommand{\lstlistlistingname}{List of Listings}
\newlistof{listings}{lol}{\lstlistlistingname}%
\renewcommand{\cftlistingspresnum}{\slcsmallcaps}%
\renewcommand{\cftlistingsfont}{\normalfont}%
\renewcommand{\cftlistingspagefont}{\normalfont}%
\ifthenelse{\boolean{@dottedtoc}}{\relax}%
{%  
	\renewcommand{\cftlistingsleader}{\hspace{1.5em}}%
	\renewcommand{\cftlistingsafterpnum}{\cftparfillskip}%
}
\renewcommand{\cftlistingspresnum}{\ssmallcaps\lstlistingname~}%
\newlength{\listingslabelwidth}%
\settowidth{\listingslabelwidth}{\cftlistingspresnum~99}%
\addtolength{\listingslabelwidth}{2.5em}%
%\cftsetindents{listings}{0em}{\listingslabelwidth}%
\cftsetindents{listings}{0em}{\figurelabelwidth}%
\let\l@lstlisting\l@listings%
\let\lstlistoflistings\listoflistings%



% remove the vertical space between lof/lot entries of different chapters
\ifthenelse{\boolean{@listsseparated}}{%
	\AtBeginDocument{%
		\addtocontents{lof}{\protect\vspace{-\cftbeforechapskip}}%
		\addtocontents{lot}{\protect\vspace{-\cftbeforechapskip}}%
	}%
}{%
	\DeclareRobustCommand*{\deactivateaddvspace}{\let\addvspace\@gobble}% 
	\AtBeginDocument{%      
		\addtocontents{lof}{\deactivateaddvspace}% 
		\addtocontents{lot}{\deactivateaddvspace}%      
      }%
}
% ******************************************************************************                
% Listings
% ******************************************************************************  
\RequirePackage{listings}%
\lstset{language=C++,
%    keywordstyle=\color{iBlue},
    basicstyle=\lstfont,	
	tabsize=4,
    %identifierstyle=\color{NavyBlue},
    commentstyle=\color{seccolor},%\ttfamily,
    %stringstyle=\rmfamily,
%    numbers=left,
    numberstyle=\scriptsize,%\tiny
	framexleftmargin=4em,
	xleftmargin=4em,
	aboveskip=\baselineskip,
	belowskip=\baselineskip,
	abovecaptionskip=\abovecaptionskip,
	belowcaptionskip=\belowcaptionskip,
    %stepnumber=1,
    numbersep=4pt,
    showstringspaces=false,
    breaklines=true,
    backgroundcolor=\color{lstbgcolor},
	rulecolor=\color{lstrlcolor},
	captionpos=b,
	framerule=1pt,
    %frameround=ftff,
    %frame=tb,
	frame=single,
	%framexleftmargin=1em,
    %frame=L
%	moredelim=[is][\bfseries\color{iRed}]{§}{§}
} 
% ******************************************************************************
% Enumeration small caps
% ******************************************************************************
\newenvironment{aenumerate}%
	{\def\theenumi{\textsc{\alph{enumi}}}\enumerate}{\endenumerate}
% ******************************************************************************
% Booktabs
% ******************************************************************************
\RequirePackage{booktabs} % for better rules in tables

% ******************************************************************************
% Footnotes setup   
% ******************************************************************************
\deffootnote{0em}{0em}{\thefootnotemark\hspace*{.5em}}      
%\setlength{\footnotemargin}{-1em}   
\addtokomafont{footnote}{\color{seccolor}}
\renewcommand{\footnoterule}{\textcolor{seccolor}{\vspace*{-3pt}%
	\hrule width 0.4\columnwidth \vspace*{2.6pt}}}

% ******************************************************************************
% Graffiti as in GKP's book "Concrete Mathematics"
% ******************************************************************************
\DeclareRobustCommand{\graffito}[1]{\marginpar{%
	\slshape\footnotesize%\small%
		\ifodd\thepage\raggedright\else\raggedleft\fi%
		\parindent=0pt\lineskip=0pt\lineskiplimit=0pt%\baselineskip=10pt
		\tolerance=2000\hyphenpenalty=300\exhyphenpenalty=300%
		\doublehyphendemerits=100000\finalhyphendemerits=\doublehyphendemerits%
		%\raggedright%
		\hspace{0pt}#1}}


% ******************************************************************************
% cleverref
% ******************************************************************************
%\RequirePackage{cleveref}
%\crefname{chapter}{Chapter}{Chapters}
%\crefname{section}{Section}{Sections}
%\crefname{subsection}{Section}{Sections}
%\crefname{subsubsection}{Section}{Sections}
%\crefname{figure}{Figure}{Figures}
%\crefname{table}{Table}{Tables}



\endinput